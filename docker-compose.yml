version: '3.8'

services:
  pve-exporter:
    image: ghcr.io/bigtcze/pve-exporter:latest
    container_name: pve-exporter
    restart: unless-stopped
    
    ports:
      - "9221:9221"
    
    environment:
      # Proxmox connection
      PVE_HOST: "proxmox.example.com"
      PVE_USER: "root@pam"
      # Use either password or token authentication
      PVE_PASSWORD: "your-password"
      # PVE_TOKEN_ID: "user@realm!tokenid"
      # PVE_TOKEN_SECRET: "your-token-secret"
      
      # Skip TLS verification (use with caution)
      PVE_INSECURE_SKIP_VERIFY: "true"
      
      # ZFS metrics
      ZFS_ENABLED: "true"
      
      # Server configuration
      LISTEN_ADDRESS: ":9221"
      METRICS_PATH: "/metrics"
    
    # Mount ZFS kstat if running on Proxmox host
    volumes:
      - /proc/spl/kstat/zfs:/proc/spl/kstat/zfs:ro
    
    # Optional: Use config file instead of environment variables
    # volumes:
    #   - ./config.yml:/app/config.yml:ro
    # command: ["-config", "/app/config.yml"]
